<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Search For your Stock</title>
    <meta name="author" content="Derek Eder[edited by Ryan Kwong]">
    <meta content="Display any CSV file as a searchable, filterable, pretty HTML table" />
    <style>
      .ticker_button{
        border: none;
        padding: 12px 20px;
        color: white;
        background-color: green;
      }
    </style>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/dataTables.bootstrap.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container-fluid">

      <h2>Find your Stock</h2>
<hr>
      <input type="text" id="ticker"><br><br>
      <button onclick="find();drawStuff();" class="ticker_button">Search Ticker</button>
      <div id='table-container'></div>

    </div><!-- /.container -->
    <h3>Free Cash Flow Chart</h3>
<div id="top_x_div" style="width: 800px; height: 600px;"></div>
    <footer class='footer'>
      <div class='container-fluid'>
        <hr />
        <p class='pull-right'><a href='https://github.com/derekeder/csv-to-html-table'>CSV to HTML Table</a> by <a href='http://derekeder.com'>Derek Eder</a><br>Stock Search made by <a href="https://biancanev.github.io/aboutme/">Ryan Kwong</a></p>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.csv.min.js"></script>
    <script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="js/dataTables.bootstrap.js"></script>
    <script type="text/javascript" src="js/csv_to_html_table.js"></script>


    <script type="text/javascript">
      function format_link(link){
        if (link)
          return link;
        else
          return "";
      }
      function find(){
      var ticker = document.getElementById("ticker").value;
      var csv = "https://financials.morningstar.com/ajax/ReportProcess4CSV.html?t="+ ticker +"&reportType=cf&period=12&dataType=A&order=asc&columnYear=5&number=3";
      var caps = ticker.toUpperCase;
      document.title = "Showing Search Results For " + ticker;
      CsvToHtmlTable.init({
        csv_path: csv,
        element: 'table-container', 
        allow_download: true,
        csv_options: {separator: ',', delimiter: '"'},
        datatables_options: {"paging": false},
        custom_formatting: [[4, format_link]]
      });
     google.charts.load('current', {'packages':['bar']});
      google.charts.setOnLoadCallback(drawStuff);

      function drawStuff() {
        document.getElementByTagName("table-container").id = "statTable";
        var x = document.getElementById("statTable").rows.length - 1;
        var data1 = document.getElementById("table-container").rows[35].cells[1].innerHTML;
        var data2 = document.getElementById("table-container").rows[35].cells[2].innerHTML;
        var data3 = document.getElementById("table-container").rows[35].cells[3].innerHTML;
        var data4 = document.getElementById("table-container").rows[35].cells[4].innerHTML;
        var data5 = document.getElementById("table-container").rows[35].cells[5].innerHTML;
        var data = new google.visualization.arrayToDataTable([
          ['Year', 'Value'],
          ["2013", data1],
          ["2014", data2],
          ["2015", data3],
          ["2016", data4],
          ['2017', data5]
        ]);

        var options = {
          width: 800,
          legend: { position: 'none' },
          chart: {
            title: 'Free Cash Flow',
            subtitle: '' },
          axes: {
            x: {
              0: { side: 'top', label: 'White to move'} // Top x-axis.
            }
          },
          bar: { groupWidth: "90%" }
        };

        var chart = new google.charts.Bar(document.getElementById('top_x_div'));
        // Convert the Classic options to Material options.
        chart.draw(data, google.charts.Bar.convertOptions(options));
      };
      }
    </script>
  </body>
</html>
